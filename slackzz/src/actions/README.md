# `actions` ç›®å½•çš„é‡è¦æ€§

`actions` ç›®å½•åœ¨ç°ä»£ Web åº”ç”¨ç¨‹åºï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨ Next.js Server Actions æˆ–ç±»ä¼¼æ¨¡å¼çš„é¡¹ç›®ï¼‰ä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ã€‚å®ƒä¸»è¦ç”¨äºå­˜æ”¾æ‰§è¡Œç‰¹å®šä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æ“ä½œçš„å‡½æ•°ã€‚

## æ ¸å¿ƒä½œç”¨

### 1. **ä¸šåŠ¡é€»è¾‘å°è£…**
å°†ä¸æ•°æ®æ“ä½œã€å¤–éƒ¨ API è°ƒç”¨æˆ–å¤æ‚è®¡ç®—ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘å°è£…åœ¨ç‹¬ç«‹çš„å‡½æ•°ä¸­ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤ã€‚

### 2. **æ•°æ®å˜æ›´ï¼ˆMutationsï¼‰**
é›†ä¸­ç®¡ç†å¯¹æ•°æ®åº“æˆ–åç«¯æ•°æ®è¿›è¡Œåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼ˆCRUDï¼‰æ“ä½œçš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼š
- `createWorkspace()` - åˆ›å»ºå·¥ä½œåŒº
- `registerWithEmail()` - ç”¨æˆ·æ³¨å†Œ
- `getUserData()` - è·å–ç”¨æˆ·æ•°æ®

### 3. **æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼ˆServer-side Executionï¼‰**
åœ¨ Next.js ç­‰æ¡†æ¶ä¸­ï¼Œ`actions` ç›®å½•ä¸­çš„æ–‡ä»¶é€šå¸¸åŒ…å«å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ç›´æ¥è¿è¡Œçš„å‡½æ•°ï¼ˆServer Actionsï¼‰ï¼Œè¿™æœ‰åŠ©äºï¼š
- **æé«˜å®‰å…¨æ€§**ï¼šæ•æ„Ÿé€»è¾‘ä¸æš´éœ²ç»™å®¢æˆ·ç«¯ï¼ŒAPI å¯†é’¥ã€æ•°æ®åº“å‡­è¯ç­‰æ•æ„Ÿä¿¡æ¯å¾—åˆ°ä¿æŠ¤
- **æå‡æ€§èƒ½**ï¼šå‡å°‘å®¢æˆ·ç«¯ JavaScript åŒ…å¤§å°ï¼Œé€»è¾‘åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ›´å¿«
- **ç±»å‹å®‰å…¨**ï¼šç»“åˆ TypeScriptï¼Œå¯ä»¥ä¸º action å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºå®šä¹‰ä¸¥æ ¼çš„ç±»å‹

### 4. **è§£è€¦ä¸å…³æ³¨ç‚¹åˆ†ç¦»**
å°†æ•°æ®æ“ä½œé€»è¾‘ä» UI ç»„ä»¶ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä½¿ï¼š
- **UI ç»„ä»¶**ä¸“æ³¨äºæ¸²æŸ“å’Œç”¨æˆ·äº¤äº’
- **Actions** ä¸“æ³¨äºæ•°æ®ç®¡ç†å’Œä¸šåŠ¡é€»è¾‘

## é‡è¦æ€§

### âœ… **ä»£ç ç»„ç»‡ä¸å¯ç»´æŠ¤æ€§**
æä¾›æ¸…æ™°çš„ç»“æ„æ¥ç»„ç»‡åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä½¿ä»£ç æ›´æ˜“äºç†è§£ã€æµ‹è¯•å’Œç»´æŠ¤ã€‚

### âœ… **å¯é‡ç”¨æ€§**
å®šä¹‰çš„ action å‡½æ•°å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†è¢«å¤šæ¬¡è°ƒç”¨ï¼Œé¿å…ä»£ç é‡å¤ã€‚

### âœ… **å®‰å…¨æ€§**
é€šè¿‡åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œæ•æ„Ÿæ“ä½œï¼Œå¯ä»¥æœ‰æ•ˆä¿æŠ¤ API å¯†é’¥ã€æ•°æ®åº“å‡­è¯ç­‰æ•æ„Ÿä¿¡æ¯ã€‚

### âœ… **æ€§èƒ½ä¼˜åŒ–**
å‡å°‘å®¢æˆ·ç«¯éœ€è¦ä¸‹è½½å’Œæ‰§è¡Œçš„ JavaScript ä»£ç é‡ï¼Œä»è€Œæå‡é¡µé¢åŠ è½½é€Ÿåº¦å’Œå“åº”æ€§ã€‚

### âœ… **ç±»å‹å®‰å…¨**
ç»“åˆ TypeScriptï¼Œå¯ä»¥ä¸º action å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºå®šä¹‰ä¸¥æ ¼çš„ç±»å‹ï¼Œæé«˜ä»£ç çš„å¥å£®æ€§å’Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯ã€‚

## ç›®å½•ç»“æ„

```
src/actions/
â”œâ”€â”€ create-workspace.ts    # åˆ›å»ºå·¥ä½œåŒºçš„é€»è¾‘
â”œâ”€â”€ get-user-data.ts       # è·å–ç”¨æˆ·æ•°æ®çš„é€»è¾‘
â”œâ”€â”€ register-with-email.ts # ç”¨æˆ·æ³¨å†Œé€»è¾‘
â””â”€â”€ README.md             # æœ¬æ–‡ä»¶
```

## å…¸å‹å†…å®¹

`actions` ç›®å½•é€šå¸¸åŒ…å«ä»¥ä¸‹ç±»å‹çš„å‡½æ•°ï¼š

### ğŸ” **ç”¨æˆ·è®¤è¯ç›¸å…³**
- `registerWithEmail()` - ç”¨æˆ·æ³¨å†Œ
- `loginUser()` - ç”¨æˆ·ç™»å½•
- `logoutUser()` - ç”¨æˆ·ç™»å‡º

### ğŸ“Š **æ•°æ® CRUD æ“ä½œ**
- `createWorkspace()` - åˆ›å»ºå·¥ä½œåŒº
- `getUserData()` - è·å–ç”¨æˆ·æ•°æ®
- `updateProfile()` - æ›´æ–°ç”¨æˆ·èµ„æ–™
- `deleteItem()` - åˆ é™¤æ•°æ®é¡¹

### ğŸ”— **å¤–éƒ¨æœåŠ¡é›†æˆ**
- `sendEmail()` - å‘é€é‚®ä»¶
- `processPayment()` - å¤„ç†æ”¯ä»˜
- `uploadFile()` - ä¸Šä¼ æ–‡ä»¶

## ä½¿ç”¨ç¤ºä¾‹

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Action

```typescript
// å®¢æˆ·ç«¯ç»„ä»¶
"use client";
import { createWorkspace } from "@/actions/create-workspace";
import { useState } from "react";

export default function CreateWorkspacePage() {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const handleSubmit = async () => {
    setIsSubmitting(true);
    const error = await createWorkspace({ name, slug, invite_code });
    if (!error) {
      // å¤„ç†æˆåŠŸæƒ…å†µ
    }
    setIsSubmitting(false);
  };

  return <button onClick={handleSubmit}>åˆ›å»º</button>;
}
```

### Action å‡½æ•°å®šä¹‰

```typescript
// actions/create-workspace.ts
"use server";

import { supabaseServerClient } from "@/supabase/supabaseServer";

export async function createWorkspace(data: {
  name: string;
  slug: string;
  invite_code: string;
}) {
  const supabase = await supabaseServerClient();
  
  const { data: workspace, error } = await supabase
    .from("workspaces")
    .insert(data)
    .select()
    .single();

  if (error) {
    return { error: error.message };
  }

  return { success: true, workspace };
}
```

## æœ€ä½³å®è·µ

1. **ä½¿ç”¨ `"use server"` æŒ‡ä»¤**ï¼šç¡®ä¿å‡½æ•°åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œ
2. **ç±»å‹å®šä¹‰**ï¼šä¸ºæ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºå®šä¹‰ TypeScript ç±»å‹
3. **é”™è¯¯å¤„ç†**ï¼šå§‹ç»ˆå¤„ç†å¯èƒ½çš„é”™è¯¯æƒ…å†µ
4. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ª action å‡½æ•°åº”è¯¥åªåšä¸€ä»¶äº‹
5. **å¯é‡ç”¨æ€§**ï¼šè®¾è®¡å‡½æ•°æ—¶è€ƒè™‘åœ¨ä¸åŒåœºæ™¯ä¸‹çš„å¤ç”¨

## æ€»ç»“

é€šè¿‡åˆç†åˆ©ç”¨ `actions` ç›®å½•ï¼Œå¯ä»¥æ„å»ºå‡ºç»“æ„æ¸…æ™°ã€å®‰å…¨é«˜æ•ˆä¸”æ˜“äºæ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯ç°ä»£ Web åº”ç”¨æ¶æ„ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç»„ç»‡ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

